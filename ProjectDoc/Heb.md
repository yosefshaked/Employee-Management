# תיק פרויקט: מערכת ניהול שכר ועובדים

**גרסה: 1.0**
**תאריך עדכון אחרון: 2025-09-05**

## 1. חזון ומטרה

מטרת הפרויקט היא לספק פתרון אפליקטיבי, נוח ויעיל לניהול תשלומי שכר לעובדים, כתחליף לקובץ אקסל שהיה מועד לטעויות. המערכת מותאמת אישית לצרכים של עסק עם שני סוגי עובדים עיקריים: עובדים שעתיים ומדריכים המקבלים תשלום פר-סשן.

**דרישות מפתח:**
- ממשק פשוט ואינטואיטיבי בעברית.
- יכולת להגדיר תעריפים דינמיים ומשתנים לאורך זמן.
- ניהול גמיש של סוגי שירותים (סשנים) שהמדריכים יכולים לבצע.
- דוחות מדויקים ואינטראקטיביים.
- שמירה על דיוק היסטורי של נתונים פיננסיים.

---

## 2. ארכיטקטורה וטכנולוגיות

המערכת בנויה בארכיטקטורת שרת-לקוח מודרנית:

*   **Frontend (צד לקוח):** אפליקציית Single Page Application (SPA) שנבנתה באמצעות:
    *   **Framework:** React
    *   **Build Tool:** Vite
    *   **Styling:** Tailwind CSS
    *   **Component Library:** shadcn/ui

*   **Backend & Database (צד שרת ובסיס נתונים):**
    *   **Platform:** Supabase (Backend-as-a-Service)
    *   **Database:** PostgreSQL
    *   **API:** נוצר אוטומטית על ידי Supabase (PostgREST).

---

## 3. מבנה בסיס הנתונים (Database Schema)

זהו לב המערכת. בסיס הנתונים מורכב מ-4 טבלאות מרכזיות:

### 3.1. טבלת `Employees`
מכילה את כל המידע הכללי על העובדים.

| עמודה | סוג | תיאור | אילוצים |
| :--- | :--- | :--- | :--- |
| `id` | `uuid` | מזהה ייחודי אוטומטי | **Primary Key** |
| `name` | `text` | שם מלא של העובד | Not NULL |
| `employee_type`| `text` | סוג העובד ('hourly' או 'instructor') | Not NULL |
| `current_rate` | `numeric` | תעריף שעתי (רלוונטי **רק** לעובדים שעתיים) | |
| `is_active` | `boolean`| האם העובד פעיל כרגע | Default: `true` |
| ... | ... | שדות נוספים: `employee_id`, `phone`, `email`, `start_date`, `notes` | |

### 3.2. טבלת `Services`
מכילה את רשימת השירותים/סשנים הדינמית שהמדריכים יכולים לבצע.

| עמודה | סוג | תיאור | אילוצים |
| :--- | :--- | :--- | :--- |
| `id` | `uuid` | מזהה ייחודי אוטומטי | **Primary Key** |
| `name` | `text` | שם השירות (למשל, "רכיבה טיפולית 30 דק'") | Not NULL |
| `duration_minutes`| `int8`| משך השירות בדקות (לצורך חישוב שעות) | |
| `payment_model` | `text` | מודל התשלום ('fixed_rate' או 'per_student') | Not NULL |

### 3.3. טבלת `RateHistory`
הטבלה החשובה ביותר. שומרת את **היסטוריית** התעריפים לכל עובד ושירות.

| עמודה | סוג | תיאור | אילוצים |
| :--- | :--- | :--- | :--- |
| `id` | `uuid` | מזהה ייחודי אוטומטי | **Primary Key** |
| `employee_id` | `uuid` | מצביע לטבלת `Employees` | **Foreign Key** |
| `service_id` | `uuid` | מצביע לטבלת `Services` (יכול להיות NULL לעובד שעתי) | **Foreign Key** |
| `rate` | `numeric` | סכום התעריף | Not NULL |
| `effective_date`| `date` | התאריך שממנו התעריף הזה נכנס לתוקף | Not NULL |
| `notes` | `text` | הערות | |
| **אילוץ ייחודיות משולב** | `UNIQUE` | על העמודות: `employee_id`, `service_id`, `effective_date` | |

### 3.4. טבלת `WorkSessions`
יומן העבודה. כל שורה היא רישום של עבודה שבוצעה.

| עמודה | סוג | תיאור | אילוצים |
| :--- | :--- | :--- | :--- |
| `id` | `uuid` | מזהה ייחודי אוטומטי | **Primary Key** |
| `employee_id` | `uuid` | מצביע לטבלת `Employees` | **Foreign Key** |
| `service_id` | `uuid` | מצביע לטבלת `Services` (רלוונטי למדריכים) | **Foreign Key** |
| `date` | `date` | תאריך ביצוע העבודה | Not NULL |
| `hours` | `numeric` | כמות שעות (רלוונטי לעובדים שעתיים) | |
| `sessions_count`| `int8` | כמות מפגשים (רלוונטי למדריכים) | |
| `students_count`| `int8` | כמות תלמידים (רלוונטי למודל `per_student`) | |
| `rate_used` | `numeric`| "הקפאה" של התעריף שהיה בשימוש בזמן החישוב | |
| `total_payment`| `numeric`| "הקפאה" של הסכום הסופי שחושב | |

---

## 4. החלטות ארכיטקטוניות ומסקנות (Lessons Learned)

במהלך הפיתוח, התקבלו מספר החלטות חשובות שעיצבו את המערכת:

1.  **ההחלטה להשתמש בטבלת `RateHistory` נפרדת:** במקום להוסיף עמודות תעריפים לטבלת `Employees`, בחרנו בטבלה נפרדת.
    *   **הסיבה:** זה מאפשר גמישות אינסופית בהוספת שירותים חדשים בלי לשנות את מבנה בסיס הנתונים, והכי חשוב - זה שומר על **היסטוריית תעריפים מדויקת**, מה שחיוני לחישובים רטרואקטיביים.
    *   **המסקנה:** דיוק היסטורי בנתונים פיננסיים גובר על הפשטות של מבנה נתונים "שטוח".

2.  **שימוש ב-`upsert` עם `onConflict` משולש:** כדי למנוע כפילויות של תעריפים באותו היום, הגדרנו `unique constraint` על שילוב של `employee_id`, `service_id`, ו-`effective_date`.
    *   **הסיבה:** זה מאפשר לנו להשתמש בפקודת `upsert` יעילה ש"דורסת" שינויים שנעשו באותו היום, ובכך מונעת "זיבול" של בסיס הנתונים ושומרת על "מקור אמת אחד" לכל יום.
    *   **המסקנה:** שימוש נכון באילוצים (constraints) בבסיס הנתונים מפשט את הלוגיקה בקוד ומונע באגים.

3.  **הפיכת קומפוננטות "חכמות" ועצמאיות:** הבאג שבו טופס העריכה לא הציג תעריפים מעודכנים נפתר על ידי הפיכת `EmployeeForm` לקומפוננטה שיודעת לטעון את הנתונים העדכניים שלה בעצמה, במקום להסתמך על מידע "ישן" מהקומפוננטה האב.
    *   **המסקנה:** חשוב לנהל את ה-`state` בחוכמה ולהבטיח שקומפוננטות תמיד עובדות עם המידע הכי עדכני שהן צריכות.

4.  **חשיבות חווית המשתמש (UX):** התלבטנו רבות לגבי התנהגות הטפסים.
    *   **ההחלטה:** במקום לאפס טפסים לחלוטין, בחרנו באיפוס חלקי וחכם, והוספנו דיאלוג אזהרה מעוצב (`AlertDialog`) כדי לתת למשתמש שליטה מלאה על פעולות שעלולות לגרום לאיבוד מידע.
    *   **המסקנה:** חווית משתמש טובה דורשת חשיבה על מקרי קצה והימנעות מפעולות אוטומטיות שעלולות לתסכל את המשתמש.

---

## 5. מדריך התקנה ופריסה

1.  שכפל את מאגר הקוד (repository).
2.  הרץ `npm install` כדי להתקין את כל התלויות.
3.  הקם פרויקט חדש ב-Supabase.
4.  צור את 4 הטבלאות לפי המבנה שצוין בסעיף 3, כולל כל הקישורים (Foreign Keys) והאילוצים (Constraints).
5.  העתק את ה-`URL` וה-`ANON KEY` של פרויקט ה-Supabase שלך והדבק אותם בקובץ `src/supabaseClient.js`.
6.  הרץ `npm run dev` כדי להפעיל את שרת הפיתוח המקומי.
7.  לשמירת הקבצים ששונו/נוספו/נמחקו נבצע סנכרון לתוך GITHUB - `git add .` (ארוז) `git commit -m` "תיאור קצר של מה שעשיתי" (תייג) `git push` (שלח)